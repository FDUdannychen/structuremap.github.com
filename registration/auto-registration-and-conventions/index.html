<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8"> 
        <meta charset="utf-8">
        <meta name="generator" content="Bootply" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<title>StructureMap - Auto-Registration and Conventions</title>
		<link href="/content/bootstrap.min.css" rel="stylesheet" type="text/css" />
		<link href="/content/prism.css" rel="stylesheet" type="text/css" />
		<link href="/content/theme.css" rel="stylesheet" type="text/css" />
		
        

        <link rel="apple-touch-icon" href="/bootstrap/img/apple-touch-icon.png">
        <link rel="apple-touch-icon" sizes="72x72" href="/bootstrap/img/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="114x114" href="/bootstrap/img/apple-touch-icon-114x114.png">


        <!-- CSS code from Bootply.com editor -->
        <link href="/content/affix.css" rel="stylesheet" type="text/css" />
    </head>
    
    <!-- HTML code from Bootply.com editor -->
    
    <body  >

<a href="https://github.com/structuremap/structuremap"><img style="z-index: 5000; position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>
        
        <nav class="navbar navbar-default navbar-fixed-top" role="banner">
		  <div class="container">
		    <div class="navbar-header">
		      <a href="/" class="navbar-brand">StructureMap</a>
		    </div>
		    <nav class="collapse navbar-collapse" role="navigation">
		      <ul class="nav navbar-nav pull-right">
            <li>
              <a href="/quickstart">A Gentle Quickstart</a>
            </li>
		        <li>
		          <a href="/documentation">Documentation</a>
		        </li>
            <li>
              <a href="https://groups.google.com/forum/#!forum/structuremap-users">Google Group</a>
            </li>
		        <li>
<a href="https://gitter.im/structuremap/structuremap?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://camo.githubusercontent.com/da2edb525cde1455a622c58c0effc3a90b9a181c/68747470733a2f2f6261646765732e6769747465722e696d2f4a6f696e253230436861742e737667" alt="Join the chat at https://gitter.im/structuremap/structuremap" data-canonical-src="https://badges.gitter.im/Join%20Chat.svg" style="max-width:100%;"></a>
		        </li>
		      	<li><a href="/registration/registry-dsl" title="Registry DSL">Previous</a></li>
		      	<li><a href="/registration/inline-dependencies" title="Inline Dependencies">Next</a></li>
		      </ul>
      <div class="navbar-form navbar-left" role="search">
        <div class="form-group">
          <input id="search" type="search" class="form-control" placeholder="Search">
        </div>
      </div>

		    </nav>

		  </div>
		</nav>

		  <div class="container">
		  	<nav class="navbar-inverse">
		  		<ol class="breadcrumb"><li><a href="/">StructureMap</a></li><li><a href="/registration">Registration</a></li><li class="active">Auto-Registration and Conventions</li></ol>
		  	</nav>
		  </div>

		<!--main-->
		<div class="container">
			<div class="row">
		      <!--left-->
		      
		      <div class="col-md-3" id="leftCol">
		      	<h3>StructureMap 3.1.6</h3>
		      	<br />

				<ul class="nav nav-stacked affix" id="sidebar">

		        </ul>

		        	<h3 class="no-margin">Next</h3><p><a href="/registration/inline-dependencies">Inline Dependencies</a></p>
		        	<h3 class="no-margin">Previous</h3><a href="/registration/registry-dsl">Registry DSL</a></p>

		        </ul>
		      </div><!--/left-->
		      
		      <!--right-->
		      <div class="col-md-9">
			      	<h1>Auto-Registration and Conventions</h1>
			      
			      	<hr />

			      	<div id="main-pane">
			      		<!--Title: Auto-Registration and Conventions-->
<!--Url: auto-registration-and-conventions-->
<p>StructureMap has rich support for registering types by scanning assemblies.
Between scanning and default conventions, configurations are often just a few
lines.</p>
<h2>Scan the Calling Assembly</h2>
<p>One of the easiest ways to register types is by scanning the assembly your
registry is placed in.</p>
<p><strong>Note</strong> if you have other registries, StructureMap will not automatically
find them.</p>
<pre><code class="language-csharp">
        [Test]
        public void scan_but_ignore_registries_by_default()
        {
            Scan(x =&gt; { x.TheCallingAssembly(); });

            TestingRegistry.WasUsed.ShouldBeFalse();
        }

</code></pre>
<h2>Scan for Registries</h2>
<p>StructureMap can automatically include other registries with the<code>LookForRegistries</code>
method.</p>
<pre><code class="language-csharp">
        [Test]
        public void Search_for_registries_when_explicitly_told()
        {
            Scan(x =&gt;
            {
                x.TheCallingAssembly();
                x.LookForRegistries();
            });

            TestingRegistry.WasUsed.ShouldBeTrue();
        }

</code></pre>
<h2>Scan the File System</h2>
<p>StructureMap provides facilities for registering types by path.</p>
<pre><code class="language-csharp">
        [Test]
        public void scan_all_assemblies_in_a_folder()
        {
            Scan(x =&gt; x.AssembliesFromPath(assemblyScanningFolder));
            shouldHaveFamilyWithSameName&lt;IInterfaceInWidget5&gt;();
            shouldHaveFamilyWithSameName&lt;IWorker&gt;();
        }

        [Test]
        public void scan_all_assemblies_in_application_base_directory()
        {
            Scan(x =&gt; x.AssembliesFromApplicationBaseDirectory());
            shouldHaveFamilyWithSameName&lt;IInterfaceInWidget5&gt;();
            shouldHaveFamilyWithSameName&lt;IWorker&gt;();
        }

</code></pre>
<h2>Excluding Types</h2>
<p>StructureMap also makes it easy to exclude types, either individually or by namespace.
The following examples also show how StructureMap can register an assembly by providing
a type within that assembly.</p>
<p>Excluding additional types or namespaces is as easy as calling the corresponding method
again.</p>
<pre><code class="language-csharp">
        [Test]
        public void use_a_single_exclude_of_type()
        {
            Scan(x =&gt;
            {
                x.AssemblyContainingType&lt;ITypeThatHasAttributeButIsNotInRegistry&gt;();
                x.ExcludeType&lt;ITypeThatHasAttributeButIsNotInRegistry&gt;();
            });

            shouldHaveFamily&lt;IInterfaceInWidget5&gt;();
            shouldNotHaveFamily&lt;ITypeThatHasAttributeButIsNotInRegistry&gt;();
        }


        [Test]
        public void use_a_single_exclude2()
        {
            Scan(x =&gt;
            {
                x.AssemblyContainingType&lt;ITypeThatHasAttributeButIsNotInRegistry&gt;();
                x.ExcludeNamespace(&quot;StructureMap.Testing.Widget5&quot;);
            });

            shouldNotHaveFamily&lt;IInterfaceInWidget5&gt;();
            shouldNotHaveFamily&lt;ITypeThatHasAttributeButIsNotInRegistry&gt;();
        }


        [Test]
        public void use_a_single_exclude3()
        {
            Scan(x =&gt;
            {
                x.AssemblyContainingType&lt;ITypeThatHasAttributeButIsNotInRegistry&gt;();
                x.ExcludeNamespaceContainingType&lt;ITypeThatHasAttributeButIsNotInRegistry&gt;();
            });

            shouldNotHaveFamily&lt;IInterfaceInWidget5&gt;();
            shouldNotHaveFamily&lt;ITypeThatHasAttributeButIsNotInRegistry&gt;();
        }

</code></pre>
<h2>Custom Registration Conventions</h2>
<p>It's just not possible (or desirable) for StructureMap to include every possible type of auto registration
convention users might want, but that's okay because StructureMap allows you to create and use your own
conventions through the <code>IRegistrationConvention</code> interface:</p>
<pre><code class="language-csharp">
    public interface IRegistrationConvention
    {
        void Process(Type type, Registry registry);
    }
</code></pre>
<p>Let's say that you'd like a custom convention that just registers a concrete type against all the interfaces
that it implements. You could then build a custom <code>IRegistrationConvention</code> class like the following example:</p>
<pre><code class="language-csharp">
        public interface IFoo
        {
        }

        public interface IBar
        {
        }

        public interface IBaz
        {
        }

        public class BusyGuy : IFoo, IBar, IBaz
        {
        }

        // Custom IRegistrationConvention
        public class AllInterfacesConvention : IRegistrationConvention
        {
            public void Process(Type type, Registry registry)
            {
                // Only work on concrete types
                if (!type.IsConcrete() || type.IsGenericType) return;

                // Register against all the interfaces implemented
                // by this concrete class
                type.GetInterfaces().Each(@interface =&gt; { registry.For(@interface).Use(type); });
            }
        }

        [Test]
        public void use_custom_registration_convention()
        {
            var container = new Container(_ =&gt;
            {
                _.Scan(x =&gt;
                {
                    // You&#39;re probably going to want to tightly filter
                    // the Type&#39;s that are applicable to avoid unwanted
                    // registrations
                    x.TheCallingAssembly();
                    x.IncludeNamespaceContainingType&lt;BusyGuy&gt;();

                    // Register the custom policy
                    x.Convention&lt;AllInterfacesConvention&gt;();
                });
            });

            container.GetInstance&lt;IFoo&gt;().ShouldBeOfType&lt;BusyGuy&gt;();
            container.GetInstance&lt;IBar&gt;().ShouldBeOfType&lt;BusyGuy&gt;();
            container.GetInstance&lt;IBaz&gt;().ShouldBeOfType&lt;BusyGuy&gt;();
        }

</code></pre>


			      	</div>

			      	<hr />

			      	<nav>
				        <span>
				        	<strong>Previous: </strong><a href="/registration/registry-dsl">Registry DSL</a>

				        </span>
				        <span class="pull-right">

				        	<strong>Next: </strong><a href="/registration/inline-dependencies">Inline Dependencies</a>

				        </span>
			      	</nav>

		      </div><!--/right-->
		  	</div><!--/row-->
		</div><!--/container-->


    </body>


    <foot>
        <script type='text/javascript' src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script type='text/javascript' src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

        <script type="text/javascript" src="/content/embed.js"></script>
        <script type="text/javascript" src="/content/prism.js"></script>
        <script type="text/javascript" src="/content/sidebar.js"></script>
        <script type="text/javascript" src="/content/affix.js"></script>

<script>
$('#search').keyup(function(e){
  if(e.keyCode == 13) {
    var search = $('#search').val();

    var url = 'https://www.google.com/#q=site:structuremap.github.io ' + search;
    url = encodeURI(url);

    //alert(url);

    window.location.href = url;

    e.stopPropagation();
    if (e.cancelBubble!=null) e.cancelBubble = true;
    return false;
  }



}); 

</script>
    </foot>
</html>

