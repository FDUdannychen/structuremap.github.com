
<!doctype html>
<html lang="en">
  <head>
    <title>
      StructureMap - Changing Configuration at Runtime</title>
    
<meta charset="utf-8"/>
<meta name="description" content="FubuDocs"/>
<meta name="author" content="FubuDocs"/>




<link href="/_content/styles/sons-of-obsidian.css" rel="stylesheet" type="text/css" />
<link href="/_content/styles/toastr.css" rel="stylesheet" type="text/css" />
<link href="/_content/styles/twitter/bootstrap.min.css" rel="stylesheet" type="text/css" />
<link href="/_content/styles/twitter/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
<link href="/_content/styles/toastr-responsive.css" rel="stylesheet" type="text/css" />
<link href="/_content/styles/fubudocs.core.css" rel="stylesheet" type="text/css" />
<link href="/_content/styles/fubudocs.theme.css" rel="stylesheet" type="text/css" />

<link media="screen" type="text/css" rel="stylesheet" href="http://fonts.googleapis.com/css?family=Oswald:400,300">

    
  </head>
  <body data-spy="scroll" data-target=".bs-docs-sidebar" position="relative">
      
    <div class="container">
      
      

<div class="row">
  <div class="span6">
    <p class="logo">
      <a href="/topics" title="Fubu" class="root-link"><span>Fubu</span></a>
      <a href="/" title="The original IoC/DI Container for .Net" class="project-logo"><span>StructureMap</span></a>
    </p>
  </div>
  <div class="span6">
    <div class="top-header text-right">
      <em>
        <em><a href="http://groups.google.com/group/structuremap-users?hl=en">Join our vibrant mailing list</a></em>
      </em>
      <div class="social">
        <a href="https://github.com/structuremap/structuremap" class="ico-github"><img alt="Github" src="/_content/images/github-icon.png" /></a>
      </div>
    </div>
  </div>
</div>
      

      <div id="nav-follow" class="navbar">
        <div class="navbar-inner">
          <div class="container">
            <ul class="nav"><li><a href="/" data-key="index">StructureMap &#187;</a></li><li><a href="/registration" data-key="index">Registration &#187;</a></li><li class="active"><a href="/registration/changing-configuration-at-runtime" data-key="changing-configuration-at-runtime">Changing Configuration at Runtime &#187;</a></li></ul>
<ul class="nav" style="float:right"><li><a href="/registration/inline-dependencies" title="Inline Dependencies">Previous</a></li><li><a href="/registration/setter-injection-policies" title="Setter Injection Policies">Next</a></li></ul>
          </div>
        </div>
      </div>
      <hr/>
      <div class="row">
        
        

        <div class="row">
          <div class="span3 sidebar" data-spy="affix" data-offset-top="150" data-offset-bottom="200">
            
            <h3 class="half-margin">Topics</h3>
            <ul id="page-toc" class="nav nav-tabs nav-stacked bs-docs-sidebar">
            </ul>
            <br/>
            <h3>
              StructureMap v1.0.0
            </h3>

            <br/>
            <h3 class="no-margin">Next</h3>
<p><a href="/registration/setter-injection-policies" data-key="setter-injection-policies">Setter Injection Policies</a></p>
<h3 class="no-margin">Previous</h3>
<p><a href="/registration/inline-dependencies" data-key="inline-dependencies">Inline Dependencies</a></p>
          </div>
          <div class="span9">

              <h1 class="no-margin">Changing Configuration at Runtime</h1>
              <hr class="header-line topic-line"></hr>

            <!--Title: Changing Configuration at Runtime-->
<!--Url: changing-configuration-at-runtime-->


<div class="alert alert-info"><i class="icon-info-sign"></i>Use the technique shown here with caution.</div>
<p>If you need to add or change configuration to an existing StructureMap <code>Container</code> object, you can use the <code>IContainer.Configure()</code> method
to add or change your container at runtime as shown below:</p>

<pre data-linenums="42" class="prettyprint lang-cs">
        [Test]
        public void change_default_in_an_existing_container()
        {
            var container = new Container(x =&gt; { x.For&lt;IFoo&gt;().Use&lt;AFoo&gt;(); });

            container.GetInstance&lt;IFoo&gt;().ShouldBeOfType&lt;AFoo&gt;();

            // Now, change the container configuration
            container.Configure(x =&gt; x.For&lt;IFoo&gt;().Use&lt;BFoo&gt;());

            // The default of IFoo is now different
            container.GetInstance&lt;IFoo&gt;().ShouldBeOfType&lt;BFoo&gt;();

            // or use the Inject method that&#39;s just syntactical
            // sugar for replacing the default of one type at a time

            container.Inject&lt;IFoo&gt;(new CFoo());

            container.GetInstance&lt;IFoo&gt;().ShouldBeOfType&lt;CFoo&gt;();
        }
</pre>

<p><section><h4 id="best-practices" class="section-header">Best Practices</h4></p>

<p>First off, the best advice on this functionality is <em>don't use it outside of testing scenarios on the root container</em>. The <code>Configure()</code> method has to use a threading lock around the internal object model of a StructureMap container and can cause serious contention at runtime if you try to override services in the main application controller. Some frameworks (looking at you NancyFx) have abused this functionality quite badly in the past and the result was not pretty.</p>

<ul>
<li>Do favor writing configuration to StructureMap <code>Registry</code> objects, then applying that <code>Registry</code> to a container rather than repeatedly calling <code>Configure()</code></li>
<li>Do not call <code>Configure()</code> on the main application container after the initial configuration. Use nested or child containers that are not shared across threads or HTTP requests if you need to override services at runtime</li>
<li>There's a potential performance hit from using <code>Configure()</code> at runtime because StructureMap has to recycle its internal <em>Build Plan's</em> based on
the potential new configuration.</li>
</ul>

<p></section></p>







          </div>
        </div>
      </div>
    </div>

    <br></br>
    <hr></hr>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <ul class="nav"><li><a href="/" data-key="index">StructureMap &#187;</a></li><li><a href="/registration" data-key="index">Registration &#187;</a></li><li class="active"><a href="/registration/changing-configuration-at-runtime" data-key="changing-configuration-at-runtime">Changing Configuration at Runtime &#187;</a></li></ul>
<ul class="nav" style="float:right"><li><a href="/registration/inline-dependencies" title="Inline Dependencies">Previous</a></li><li><a href="/registration/setter-injection-policies" title="Setter Injection Policies">Next</a></li></ul>
        </div>
      </div>
    </div>
    
    
    

<script type="text/javascript" src="/_content/scripts/jquery-1.8.2.min.js"></script>
<script type="text/javascript" src="/_content/scripts/prettify.js"></script>
<script type="text/javascript" src="/_content/scripts/bootstrap-prettify.js"></script>
<script type="text/javascript" src="/_content/scripts/fubudocs.js"></script>
<script type="text/javascript" src="/_content/scripts/jquery.nestable.js"></script>
<script type="text/javascript" src="/_content/scripts/toastr.js"></script>
<script type="text/javascript" src="/_content/scripts/twitter/bootstrap.min.js"></script>
<script type="text/javascript" src="/_content/scripts/diagnostics/bootstrap-scrollspy.js"></script>
<script type="text/javascript" src="/_content/scripts/fubudocs-tools.js"></script>
<script type="text/javascript" src="/_content/scripts/twitter/bootstrap-affix.js"></script>
<script type="text/javascript" src="/_content/scripts/topics.js"></script>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
    </p>
    <p>
      Powered by <a href="http://github.com/DarthFubuMVC/FubuDocs">FubuDocs</a>.
    </p>
  </div>
</footer>
  </body>
</html>